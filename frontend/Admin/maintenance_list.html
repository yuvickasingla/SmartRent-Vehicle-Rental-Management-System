<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maintenance Records | Admin | SmartRent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../static/style.css">
  <script src="../static/config.js"></script>
</head>

<body>

<header class="site-header">
  <div class="container nav">

    <a href="../index.html" class="nav__brand">
      <div class="nav__logo"></div>
      <div class="nav__brand-text">
        <span>SmartRent</span>
        <span>Admin Panel</span>
      </div>
    </a>

    <input type="checkbox" id="nav-toggle" class="nav__toggle">
    <label for="nav-toggle" class="nav__burger">☰</label>

    <ul class="nav__links">
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="vehicles_list.html">Vehicles</a></li>
      <li><a href="vehicle_add.html">Add Vehicle</a></li>
      <li><a href="drivers_list.html">Drivers</a></li>
      <li><a href="driver_add.html">Add Driver</a></li>
      <li><a href="customers_list.html">Customers</a></li>
      <li><a href="bookings_list.html">Bookings</a></li>
      <li><a href="payments_list.html">Payments</a></li>
      <li><a href="maintenance_list.html">Maintenance</a></li>
      <li><a href="maintenance_add.html">Add Maintenance</a></li>
      <li class="nav__cta"><a href="../login.html">Logout</a></li>
    </ul>

  </div>
</header>

<main>
<section class="page-shell">
  <div class="container">

    <div class="section-header">
      <h1>Maintenance Records</h1>
      <p>Track all vehicle maintenance activity.</p>
    </div>

    <p id="msg" style="margin-bottom: 10px;"></p>

    <div class="table-shell">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Vehicle</th>
            <th>Date</th>
            <th>Cost</th>
            <th>Details</th>
          </tr>
        </thead>

        <tbody id="maintenance-body">
          <!-- dynamic rows -->
        </tbody>

      </table>
    </div>

  </div>
</section>
</main>

<footer>
  <div class="container">
    <span>© 2025 SmartRent</span>
  </div>
</footer>

<script>
    async function loadMaintenance() {
      const msg = document.getElementById("msg");
      const tbody = document.getElementById("maintenance-body");
    
      try {
        const [maintRes, vehicleRes] = await Promise.all([
          fetch(window.API_BASE_URL + "/maintenance/", { credentials: "include" }),
          fetch(window.API_BASE_URL + "/vehicles/", { credentials: "include" })
        ]);
    
        if (!maintRes.ok || !vehicleRes.ok) {
          msg.style.color = "red";
          msg.textContent = "Failed to fetch maintenance data.";
          return;
        }
    
        const maintenance = await maintRes.json();
        const vehicles = await vehicleRes.json();
    
        // Correct field mapping
        const vehicleMap = {};
        vehicles.forEach(v => {
          vehicleMap[v.id] = `${v.brand} ${v.model} (${v.vehicle_number})`;
        });
    
        tbody.innerHTML = "";
    
        if (maintenance.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" style="text-align:center; padding:20px;">No maintenance records found.</td>
            </tr>
          `;
          return;
        }
    
        maintenance.forEach(m => {
          const vehicleName = vehicleMap[m.vehicle_id] || "Unknown Vehicle";
    
          tbody.innerHTML += `
            <tr>
              <td>${m.id}</td>
              <td>${vehicleName}</td>
              <td>${m.date}</td>
              <td>₹${m.cost}</td>
              <td>${m.details}</td>
            </tr>
          `;
        });
    
      } catch (error) {
        msg.style.color = "red";
        msg.textContent = "Network error: Backend not reachable.";
      }
    }
    
    loadMaintenance();
</script>
    

</body>
</html>
